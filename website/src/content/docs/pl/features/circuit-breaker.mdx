---
title: Wylacznik automatyczny i przelaczanie awaryjne
description: Automatyczne wykrywanie awarii i przelaczanie do zapasowego dostawcy
---

Claudex zawiera wbudowany wylacznik automatyczny dla kazdego profilu dostawcy, z automatycznym przelaczaniem awaryjnym do dostawcow zapasowych po wykryciu awarii.

## Stany wylacznika automatycznego

```
         sukces
    ┌──────────────┐
    │              │
    ▼    awaria    │
 Zamkniety ──────► Otwarty
    ▲              │
    │   limit      │
    │   czasu      ▼
    └─────────── PolOtwarty
                   │
                awaria → powrot do Otwarty
```

| Stan | Zachowanie |
|------|-----------|
| **Zamkniety** | Normalne dzialanie. Zadania przechodza. Awarie sa liczone. |
| **Otwarty** | Zadania sa blokowane. Wyzwala przelaczanie awaryjne do dostawcow zapasowych. |
| **PolOtwarty** | Po uplynieciu limitu czasu odzyskiwania jedno zadanie probne jest przepuszczane. Sukces → Zamkniety; Awaria → powrot do Otwarty. |

## Domyslne parametry

| Parametr | Wartosc |
|----------|---------|
| Prog awarii | 3 kolejne awarie |
| Limit czasu odzyskiwania | 30 sekund |

## Konfiguracja przelaczania awaryjnego

Zdefiniuj dostawcow zapasowych w profilu, aby wlaczyc automatyczne przelaczanie awaryjne:

```toml
[[profiles]]
name = "grok"
provider_type = "OpenAICompatible"
base_url = "https://api.x.ai/v1"
api_key = "xai-..."
default_model = "grok-3-beta"
backup_providers = ["deepseek", "chatgpt"]   # lancuch przelaczania awaryjnego
```

Gdy `grok` zawiedzie 3 razy z rzedu:
1. Wylacznik automatyczny otwiera sie dla `grok`
2. Zadanie jest ponawiane z `deepseek`
3. Jesli `deepseek` tez zawiedzie, probuje `chatgpt`
4. Kazdy dostawca zapasowy ma wlasny niezalezny wylacznik automatyczny

## Ponowna proba OAuth 401

Dla profili OAuth odpowiedzi HTTP 401 sa obslugiwane specjalnie:

1. Proxy uniewazniona biezacy token OAuth
2. Podejmuje probe zaladowania nowego tokenu z lancucha poswiadczen
3. Ponawia zadanie z nowym tokenem
4. Liczy sie jako awaria wylacznika automatycznego tylko jesli ponowna proba rowniez sie nie powiedzie

Zapobiega to wywolywaaniu niepotrzebnych przelaczan awaryjnych przez tymczasowe wygasniecie tokenu.

## Sprawdzanie kondycji

Proces sprawdzania kondycji w tle dziala co ~30 sekund, wysylajac lekkie zadania probne do wszystkich aktywnych profili. Status kondycji jest wyswietlany w pulpicie TUI z kodowaniem kolorami:

- Zielony: zdrowy
- Zolty: zdegradowany (ostatnie awarie)
- Czerwony: wylacznik automatyczny otwarty
