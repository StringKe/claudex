---
title: 配置
description: 如何配置 Claudex 的 profile 和设置
---

import { Aside } from '@astrojs/starlight/components';

## 配置文件发现

Claudex 按以下顺序搜索配置文件：

1. `$CLAUDEX_CONFIG` 环境变量
2. `./claudex.toml`（当前目录）
3. `./.claudex/config.toml`（当前目录）
4. 父目录（最多向上 10 级），检查上述两种模式
5. `~/.config/claudex/config.toml`（全局 — 不存在时自动创建）

```bash
# 查看加载的配置路径和搜索顺序
claudex config

# 在当前目录创建本地配置
claudex config --init
```

<Aside type="tip">
  项目级配置（`./claudex.toml`）优先于全局配置，可以为不同项目定制提供商。
</Aside>

## 全局设置

```toml
# Claude 二进制文件路径（默认：从 PATH 中查找 "claude"）
# claude_binary = "/usr/local/bin/claude"

# 代理设置
proxy_port = 13456
proxy_host = "127.0.0.1"

# 日志级别：trace, debug, info, warn, error
log_level = "info"

# 模型别名（简称 → 完整模型名）
[model_aliases]
grok3 = "grok-3-beta"
gpt4o = "gpt-4o"
ds3 = "deepseek-chat"
```

## Profile 配置

每个 profile 代表一个 AI 提供商连接。有两种提供商类型：

### DirectAnthropic

用于原生支持 Anthropic Messages API 的提供商。请求以最小修改直接转发。

```toml
[[profiles]]
name = "anthropic"
provider_type = "DirectAnthropic"
base_url = "https://api.anthropic.com"
api_key = "sk-ant-..."
default_model = "claude-sonnet-4-20250514"
priority = 100
enabled = true
```

兼容提供商：**Anthropic**、**MiniMax**、**OpenRouter**

### OpenAICompatible

用于使用 OpenAI Chat Completions API 的提供商。Claudex 自动在 Anthropic 和 OpenAI 协议之间翻译。

```toml
[[profiles]]
name = "grok"
provider_type = "OpenAICompatible"
base_url = "https://api.x.ai/v1"
api_key = "xai-..."
default_model = "grok-3-beta"
backup_providers = ["deepseek"]
priority = 100
enabled = true
```

兼容提供商：**Grok (xAI)**、**OpenAI**、**DeepSeek**、**Kimi/Moonshot**、**GLM（智谱）**、**Ollama**、**vLLM**、**LM Studio**

### Profile 字段

| 字段 | 默认值 | 说明 |
|------|--------|------|
| `name` | *必填* | 唯一标识名 |
| `provider_type` | `DirectAnthropic` | `DirectAnthropic` 或 `OpenAICompatible` |
| `base_url` | *必填* | 提供商 API 端点 |
| `api_key` | `""` | API 密钥（明文） |
| `api_key_keyring` | — | 从 OS 钥匙链读取 API 密钥 |
| `default_model` | *必填* | 默认使用的模型 |
| `backup_providers` | `[]` | 故障转移 profile 名列表 |
| `custom_headers` | `{}` | 额外 HTTP 请求头 |
| `extra_env` | `{}` | 启动 Claude 时的额外环境变量 |
| `priority` | `100` | 智能路由优先级 |
| `enabled` | `true` | 是否启用 |

### 交互式设置

添加 profile 最简单的方式是使用交互式向导：

```bash
claudex profile add
```

它会引导你完成提供商选择、API 密钥输入（支持 keyring 存储）、模型选择和连通性测试。

## 密钥环集成

将 API 密钥安全存储在 OS 钥匙链中，而非明文配置：

```toml
[[profiles]]
name = "grok"
api_key_keyring = "grok-api-key"   # 从 OS 钥匙链读取
```

支持的后端：
- **macOS**：Keychain
- **Linux**：Secret Service（GNOME Keyring / KDE Wallet）

## 完整示例

参见 [`config.example.toml`](https://github.com/StringKe/claudex/blob/main/config.example.toml) 获取包含所有提供商和选项的完整配置文件。
