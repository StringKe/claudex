---
title: 斷路器與故障轉移
description: 自動故障偵測和提供商故障轉移
---

Claudex 為每個提供商 profile 內建斷路器，在偵測到故障時自動轉移到備用提供商。

## 斷路器狀態

```
         成功
    ┌──────────────┐
    │              │
    ▼    失敗      │
 關閉 ────────► 開啟
    ▲              │
    │   逾時       │
    │   到期       ▼
    └─────────── 半開
                   │
                失敗 → 回到開啟
```

| 狀態 | 行為 |
|------|------|
| **關閉** | 正常運作。請求通過。計算失敗次數。 |
| **開啟** | 請求被封鎖。觸發故障轉移到備用提供商。 |
| **半開** | 復原逾時後，允許一個探測請求通過。成功 → 關閉；失敗 → 回到開啟。 |

## 預設參數

| 參數 | 值 |
|------|----|
| 失敗閾值 | 連續 3 次失敗 |
| 復原逾時 | 30 秒 |

## 故障轉移設定

在您的 profile 中定義備用提供商以啟用自動故障轉移：

```toml
[[profiles]]
name = "grok"
provider_type = "OpenAICompatible"
base_url = "https://api.x.ai/v1"
api_key = "xai-..."
default_model = "grok-3-beta"
backup_providers = ["deepseek", "chatgpt"]   # 故障轉移鏈
```

當 `grok` 連續失敗 3 次時：
1. `grok` 的斷路器開啟
2. 請求改用 `deepseek` 重試
3. 若 `deepseek` 也失敗，改試 `chatgpt`
4. 每個備用提供商都有自己獨立的斷路器

## 健康檢查

背景健康檢查器每約 30 秒運行一次，向所有已啟用的 profile 發送輕量探測請求。健康狀態在 TUI 儀表板中以顏色標示：

- 綠色：正常
- 黃色：降級（最近有失敗）
- 紅色：斷路器開啟
