---
title: 설정
description: Claudex 프로파일 및 설정을 구성하는 방법
---

import { Aside } from '@astrojs/starlight/components';

## 설정 파일 탐색 순서

Claudex는 다음 순서로 설정 파일을 탐색합니다:

1. `$CLAUDEX_CONFIG` 환경 변수
2. `./claudex.toml` (현재 디렉토리)
3. `./.claudex/config.toml` (현재 디렉토리)
4. 상위 디렉토리 (최대 10단계), 두 패턴 모두 확인
5. `~/.config/claudex/config.toml` (XDG — 플랫폼별 경로보다 **먼저** 확인)

<Aside type="note">
  XDG 경로(`~/.config/claudex/config.toml`)는 이제 플랫폼별 경로보다 먼저 확인됩니다. 어디에도 설정 파일이 없으면 기본 설정 생성 시 XDG 경로가 사용됩니다.
</Aside>

```bash
# 로드된 설정 경로 및 탐색 순서 표시
claudex config

# 현재 디렉토리에 로컬 설정 생성
claudex config --init
```

<Aside type="tip">
  프로젝트 수준 설정(`./claudex.toml`)이 전역 설정보다 우선 적용되므로, 프로젝트별로 제공자를 커스터마이징할 수 있습니다.
</Aside>

## 전역 설정

```toml
# claude 바이너리 경로 (기본값: PATH에서 "claude")
# claude_binary = "/usr/local/bin/claude"

# 프록시 설정
proxy_port = 13456
proxy_host = "127.0.0.1"

# 로그 레벨: trace, debug, info, warn, error
log_level = "info"

# 모델 별칭 (단축명 → 전체 모델명)
[model_aliases]
grok3 = "grok-3-beta"
gpt4o = "gpt-4o"
ds3 = "deepseek-chat"
```

## 프로파일

각 프로파일은 AI 제공자 연결을 나타냅니다. 세 가지 제공자 유형이 있습니다:

### DirectAnthropic

Anthropic Messages API를 네이티브로 지원하는 제공자용. 요청이 최소한의 수정으로 전달됩니다.

```toml
[[profiles]]
name = "anthropic"
provider_type = "DirectAnthropic"
base_url = "https://api.anthropic.com"
api_key = "sk-ant-..."
default_model = "claude-sonnet-4-20250514"
priority = 100
enabled = true
```

호환 제공자: **Anthropic**, **MiniMax**

### OpenAICompatible

OpenAI Chat Completions API를 사용하는 제공자용. Claudex가 Anthropic과 OpenAI 프로토콜 간을 자동으로 변환합니다.

```toml
[[profiles]]
name = "grok"
provider_type = "OpenAICompatible"
base_url = "https://api.x.ai/v1"
api_key = "xai-..."
default_model = "grok-3-beta"
backup_providers = ["deepseek"]
priority = 100
enabled = true
```

호환 제공자: **Grok (xAI)**, **OpenAI**, **DeepSeek**, **Kimi/Moonshot**, **GLM (Zhipu)**, **OpenRouter**, **Ollama**, **vLLM**, **LM Studio**

### OpenAIResponses

OpenAI Responses API를 사용하는 제공자용 (예: ChatGPT/Codex 구독). Claudex가 Anthropic Messages API와 OpenAI Responses API 간을 변환합니다.

```toml
[[profiles]]
name = "codex-sub"
provider_type = "OpenAIResponses"
base_url = "https://chatgpt.com/backend-api/codex"
default_model = "gpt-4o"
auth_type = "oauth"
oauth_provider = "openai"
```

호환 제공자: **ChatGPT/Codex 구독** (Codex CLI를 통해)

<Aside type="tip">
  이 제공자 유형은 주로 OAuth 구독과 함께 사용됩니다. Codex CLI 설정에 대한 자세한 안내는 [제공자 설정 가이드](/ko/guides/provider-setup/)를 참조하세요.
</Aside>

### 프로파일 필드

| 필드 | 기본값 | 설명 |
|-------|---------|-------------|
| `name` | *필수* | 고유한 프로파일 식별자 |
| `provider_type` | `DirectAnthropic` | `DirectAnthropic`, `OpenAICompatible`, 또는 `OpenAIResponses` |
| `base_url` | *필수* | 제공자 API 엔드포인트 |
| `api_key` | `""` | API 키 (평문) |
| `api_key_keyring` | — | OS 키체인에서 API 키 읽기 |
| `default_model` | *필수* | 기본으로 사용할 모델 |
| `auth_type` | `"api-key"` | `"api-key"` 또는 `"oauth"` |
| `oauth_provider` | — | OAuth 제공자 (`claude`, `openai`, `google`, `qwen`, `kimi`, `github`). `auth_type = "oauth"` 시 필수 |
| `backup_providers` | `[]` | 장애 조치 프로파일 이름 목록 |
| `custom_headers` | `{}` | 추가 HTTP 헤더 |
| `extra_env` | `{}` | Claude용 추가 환경 변수 |
| `priority` | `100` | 스마트 라우팅 우선순위 |
| `enabled` | `true` | 이 프로파일의 활성화 여부 |
| `[profiles.models]` | — | 모델 슬롯 매핑 테이블 (`haiku`, `sonnet`, `opus` 필드) |

### 대화형 설정

프로파일을 추가하는 가장 쉬운 방법은 대화형 마법사입니다:

```bash
claudex profile add
```

제공자 선택, API 키 입력(선택적 키링 저장), 모델 선택, 연결 테스트를 안내합니다.

## 키링 통합

평문 설정 대신 OS 키체인에 API 키를 안전하게 저장:

```toml
[[profiles]]
name = "grok"
api_key_keyring = "grok-api-key"   # OS 키체인에서 읽기
```

지원 백엔드:
- **macOS**: Keychain
- **Linux**: Secret Service (GNOME Keyring / KDE Wallet)

## OAuth 구독 인증

API 키 대신 OAuth를 통해 기존 제공자 구독으로 인증할 수 있습니다. Claude Pro/Team, ChatGPT Plus 또는 기타 구독 플랜이 있는 경우 유용합니다.

### 설정

1. 프로파일의 `auth_type`을 `"oauth"`로 설정하고 `oauth_provider`를 지정합니다:

```toml
[[profiles]]
name = "chatgpt-oauth"
provider_type = "OpenAICompatible"
base_url = "https://api.openai.com/v1"
default_model = "gpt-4o"
auth_type = "oauth"
oauth_provider = "openai"
```

2. `auth` 명령으로 로그인:

```bash
claudex auth login openai
```

3. 인증 상태 확인:

```bash
claudex auth status
```

### 지원 제공자

| 제공자 | `oauth_provider` | 토큰 소스 |
|----------|-----------------|-------------|
| Claude | `claude` | `~/.claude`에서 읽기 (Claude Code의 네이티브 설정) |
| OpenAI | `openai` | `~/.codex/auth.json`에서 읽기 (Codex CLI) |
| Google | `google` | OAuth device code 플로우 |
| Qwen | `qwen` | OAuth device code 플로우 |
| Kimi | `kimi` | OAuth device code 플로우 |
| GitHub | `github` | OAuth device code 플로우 |

<Aside type="tip">
  **OpenAI**의 경우, [Codex CLI](https://github.com/openai/codex)가 설치되어 로그인(`codex auth`)되어 있는지 확인하세요. Claudex가 `~/.codex/auth.json`에서 토큰을 자동으로 읽습니다. 프로파일은 Responses API를 통해 통신하기 위해 `provider_type = "OpenAIResponses"`를 사용해야 합니다.
</Aside>

<Aside type="tip">
  **Claude**의 경우, Claudex가 `~/.claude`에서 기존 Claude Code OAuth 세션을 읽습니다. 이미 Claude Code에 로그인되어 있다면 별도의 로그인 단계가 필요 없습니다.
</Aside>

### 게이트웨이 인증 모드

OAuth 프로파일 사용 시, Claudex는 Claude Code 실행 시 `ANTHROPIC_API_KEY` 대신 `ANTHROPIC_AUTH_TOKEN`을 설정합니다. 이는 내부적으로 `ANTHROPIC_API_KEY`를 사용하는 Claude Code 자체 구독 로그인 메커니즘과의 충돌을 방지합니다.

프록시는 OAuth 토큰이 만료되기 전에 자동으로 갱신합니다. 수동으로 갱신하려면:

```bash
claudex auth refresh openai
```

## 모델 슬롯 매핑

Claude Code에는 **haiku**, **sonnet**, **opus** 세 가지 슬롯을 가진 내장 `/model` 전환기가 있습니다. 기본적으로 Anthropic 모델에 매핑되지만, Claudex를 통해 임의의 제공자 모델에 매핑할 수 있습니다.

### 설정

프로파일에 `[profiles.models]` 테이블 추가:

```toml
[[profiles]]
name = "grok"
provider_type = "OpenAICompatible"
base_url = "https://api.x.ai/v1"
api_key = "xai-..."
default_model = "grok-3-beta"

[profiles.models]
haiku = "grok-3-mini-beta"
sonnet = "grok-3-beta"
opus = "grok-3-beta"
```

Claude Code 내에서 `/model sonnet`을 입력하면, Claudex가 `grok-3-beta`를 사용하도록 요청을 변환합니다. `/model opus` 명령도 마찬가지로 `grok-3-beta`에 매핑됩니다.

### 일반 제공자 예시

```toml
# OpenAI 모델 매핑
[profiles.models]
haiku = "gpt-4o-mini"
sonnet = "gpt-4o"
opus = "o1"

# DeepSeek 모델 매핑
[profiles.models]
haiku = "deepseek-chat"
sonnet = "deepseek-chat"
opus = "deepseek-reasoner"

# Google Gemini 모델 매핑
[profiles.models]
haiku = "gemini-2.0-flash"
sonnet = "gemini-2.5-pro"
opus = "gemini-2.5-pro"
```

<Aside type="note">
  모델 슬롯이 설정되지 않은 경우, 프로파일의 `default_model`이 폴백으로 사용됩니다.
</Aside>

## 도구 이름 호환성

일부 제공자(특히 OpenAI)는 도구(함수) 이름에 64자 제한을 적용합니다. Claude Code는 이 제한을 초과하는 도구 이름을 생성할 수 있습니다.

Claudex는 OpenAI 호환 제공자에 요청을 보낼 때 64자를 초과하는 도구 이름을 자동으로 단축하고, 응답 처리 시 원래 이름을 투명하게 복원합니다. 이 왕복 처리는 완전히 투명하며 별도의 설정이 필요 없습니다.

## 비대화형 모드

Claudex는 CI/CD 파이프라인, 스크립트, 자동화에서의 단발성(비대화형) 실행을 지원합니다:

```bash
# 응답을 출력하고 종료
claudex run grok "Explain this codebase" --print

# 모든 권한 프롬프트 건너뛰기 (완전 자동화 파이프라인용)
claudex run grok "Fix lint errors" --print --dangerously-skip-permissions
```

<Aside type="caution">
  `--dangerously-skip-permissions`는 모든 안전 프롬프트를 비활성화합니다. 신뢰할 수 있는 자동화 환경에서만 사용하세요.
</Aside>

비대화형 모드에서는 stderr 대신 `~/Library/Caches/claudex/proxy-{timestamp}-{pid}.log` 인스턴스별 로그 파일에 로그가 기록되어, 파이핑 및 자동화를 위해 stdout 출력이 깔끔하게 유지됩니다.

## 인스턴스별 로그 파일

각 Claudex 프록시 인스턴스는 자체 파일에 로그를 기록합니다:

```
~/Library/Caches/claudex/proxy-{timestamp}-{pid}.log
```

여러 인스턴스를 동시에 실행할 때 로그가 뒤섞이는 것을 방지하고, `claudex run` 실행 중(특히 비대화형 모드에서) stderr를 깔끔하게 유지합니다. 로그에는 프록시 시작, 요청 변환, OAuth 토큰 갱신 이벤트, 서킷 브레이커 상태 변경이 포함됩니다.

## 전체 예시

모든 제공자 및 옵션이 포함된 완전한 설정 파일은 [`config.example.toml`](https://github.com/StringKe/claudex/blob/main/config.example.toml)을 참조하세요.

각 제공자의 단계별 설정 안내(API 키 링크 및 OAuth 플로우 포함)는 [제공자 설정 가이드](/ko/guides/provider-setup/)를 참조하세요.
