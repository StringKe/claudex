---
title: Прокси-переводчик
description: Автоматический перевод протокола Anthropic в OpenAI
---

import { Aside } from '@astrojs/starlight/components';

Прокси-переводчик является ядром Claudex. Он располагается между Claude Code и вашими AI-провайдерами, прозрачно выполняя конвертацию между Anthropic Messages API и OpenAI Chat Completions API.

## Как это работает

```
Claude Code → запрос Anthropic Messages API
    │
    └── Прокси Claudex (127.0.0.1:13456)
        │
        ├── Провайдер DirectAnthropic → пересылка с заголовками
        │
        ├── Провайдер OpenAICompatible
        │   ├── Перевод запроса: Anthropic → OpenAI Chat Completions
        │   ├── Пересылка провайдеру
        │   └── Перевод ответа: OpenAI → Anthropic
        │
        └── Провайдер OpenAIResponses
            ├── Перевод запроса: Anthropic → OpenAI Responses API
            ├── Пересылка провайдеру
            └── Перевод ответа: Responses → Anthropic
```

## Что переводится

### Перевод запросов (Anthropic → OpenAI)

| Anthropic | OpenAI |
|-----------|--------|
| Поле `system` | Системное сообщение в массиве `messages` |
| Блоки `messages[].content` (text, image, tool_use) | `messages[].content` + `tool_calls` |
| Массив `tools` (JSON Schema) | Массив `tools` (формат функций) |
| `tool_choice` | `tool_choice` |
| `max_tokens` | `max_tokens` |
| `temperature`, `top_p` | Прямое соответствие |

### Перевод ответов (OpenAI → Anthropic)

| OpenAI | Anthropic |
|--------|-----------|
| `choices[0].message.content` | Блоки `content` |
| `choices[0].message.tool_calls` | Блоки содержимого `tool_use` |
| `finish_reason: stop` | `stop_reason: end_turn` |
| `finish_reason: tool_calls` | `stop_reason: tool_use` |
| `usage.prompt_tokens` / `completion_tokens` | `usage.input_tokens` / `output_tokens` |

## Потоковый перевод

Claudex полностью поддерживает потоковую передачу SSE (Server-Sent Events), переводя фрагменты потока OpenAI в события потока Anthropic в режиме реального времени:

| OpenAI SSE | Anthropic SSE |
|------------|---------------|
| Первый фрагмент | `message_start` + `content_block_start` |
| `choices[0].delta.content` | `content_block_delta` (text_delta) |
| `choices[0].delta.tool_calls` | `content_block_delta` (input_json_delta) |
| Наличие `finish_reason` | `content_block_stop` + `message_delta` + `message_stop` |

Потоковый переводчик поддерживает конечный автомат для правильной обработки накопления вызовов инструментов и границ блоков содержимого.

## Поддерживаемые провайдеры

| Провайдер | Тип | Base URL |
|-----------|-----|----------|
| Anthropic | DirectAnthropic | `https://api.anthropic.com` |
| MiniMax | DirectAnthropic | `https://api.minimax.io/anthropic` |
| OpenRouter | OpenAICompatible | `https://openrouter.ai/api/v1` |
| Grok (xAI) | OpenAICompatible | `https://api.x.ai/v1` |
| OpenAI | OpenAICompatible | `https://api.openai.com/v1` |
| DeepSeek | OpenAICompatible | `https://api.deepseek.com` |
| Kimi/Moonshot | OpenAICompatible | `https://api.moonshot.cn/v1` |
| GLM (Zhipu) | OpenAICompatible | `https://open.bigmodel.cn/api/paas/v4` |
| Ollama | OpenAICompatible | `http://localhost:11434/v1` |
| vLLM | OpenAICompatible | `http://localhost:8000/v1` |
| ChatGPT/Codex sub | OpenAIResponses | `https://chatgpt.com/backend-api/codex` |

<Aside type="tip">
  Провайдеры DirectAnthropic не требуют перевода. Провайдеры OpenAIResponses используют Responses API (конечная точка `/responses`) вместо Chat Completions (`/chat/completions`).
</Aside>

## Управление прокси

```bash
# Запустить прокси как демон
claudex proxy start -d

# Проверить статус прокси
claudex proxy status

# Остановить демон прокси
claudex proxy stop

# Запустить на нестандартном порту
claudex proxy start -p 8080
```

При выполнении `claudex run <profile>` прокси автоматически запускается в фоне, если он ещё не запущен.
