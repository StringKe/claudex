---
title: Умная маршрутизация
description: Автоматическая маршрутизация запросов к провайдерам на основе намерений
---

import { Aside } from '@astrojs/starlight/components';

Умная маршрутизация автоматически выбирает наилучшего провайдера для каждого запроса на основе классификации намерений. Используйте `claudex run auto` для её активации.

## Как это работает

1. Пользователь запускает `claudex run auto`
2. Claude Code отправляет запрос к прокси
3. Прокси извлекает сообщение пользователя и отправляет его локальному классификатору (например, Ollama)
4. Классификатор возвращает категорию намерения (code, analysis, creative, search, math)
5. Правила маршрутизации сопоставляют намерение с оптимальным профилем провайдера
6. Запрос пересылается выбранному провайдеру

## Конфигурация

```toml
[router]
enabled = true
profile = "local-qwen"      # переиспользовать base_url + api_key из профиля для классификации
model = "qwen2.5:3b"        # переопределение модели (опционально, по умолчанию default_model профиля)

[router.rules]
code = "deepseek"       # задачи по коду → DeepSeek
analysis = "grok"       # аналитические задачи → Grok
creative = "chatgpt"    # творческое письмо → ChatGPT
search = "kimi"         # поиск/исследование → Kimi
math = "deepseek"       # математика/логика → DeepSeek
default = "grok"        # резерв для неклассифицированных запросов
```

## Категории намерений

| Намерение | Описание | Примеры задач |
|-----------|----------|---------------|
| `code` | Программирование и генерация кода | Написать функцию, исправить ошибку, рефакторинг кода |
| `analysis` | Анализ данных и логическое рассуждение | Анализ логов, сравнение подходов, объяснение концепций |
| `creative` | Творческое письмо и генерация идей | Написать документацию, придумать названия, составить письма |
| `search` | Поиск информации | Найти документацию по API, найти коды ошибок |
| `math` | Математические и логические задачи | Вычислить сложность, доказать корректность |

<Aside type="note">
  Умная маршрутизация требует службы LLM для классификации намерений. Она переиспользует `base_url` и `api_key` из существующего профиля. Модель классификатора должна быть небольшой и быстрой — хорошо подходит `qwen2.5:3b`.
</Aside>

## Использование

```bash
# Запуск с умной маршрутизацией
claudex run auto

# Переопределение модели при автоматической маршрутизации
claudex run auto -m grok-3-mini-beta
```
