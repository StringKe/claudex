---
title: Автоматический выключатель и переключение при сбое
description: Автоматическое обнаружение сбоев и переключение между провайдерами
---

Claudex включает встроенный автоматический выключатель для каждого профиля провайдера с автоматическим переключением на резервных провайдеров при обнаружении сбоев.

## Состояния автоматического выключателя

```
         успех
    ┌──────────────┐
    │              │
    ▼    сбой      │
 Закрыт ─────────► Открыт
    ▲              │
    │   таймаут    │
    │   истёк      ▼
    └─────────── Полуоткрыт
                   │
                сбой → обратно в Открыт
```

| Состояние | Поведение |
|-----------|-----------|
| **Закрыт** | Нормальная работа. Запросы проходят. Сбои подсчитываются. |
| **Открыт** | Запросы блокируются. Активируется переключение на резервных провайдеров. |
| **Полуоткрыт** | После истечения таймаута восстановления пропускается один пробный запрос. Успех → Закрыт; Сбой → обратно в Открыт. |

## Параметры по умолчанию

| Параметр | Значение |
|----------|----------|
| Порог сбоев | 3 последовательных сбоя |
| Таймаут восстановления | 30 секунд |

## Настройка переключения при сбое

Определите резервных провайдеров в вашем профиле для включения автоматического переключения:

```toml
[[profiles]]
name = "grok"
provider_type = "OpenAICompatible"
base_url = "https://api.x.ai/v1"
api_key = "xai-..."
default_model = "grok-3-beta"
backup_providers = ["deepseek", "chatgpt"]   # цепочка переключения
```

Когда `grok` даёт сбой 3 раза подряд:
1. Автоматический выключатель открывается для `grok`
2. Запрос повторяется с `deepseek`
3. Если `deepseek` тоже даёт сбой, используется `chatgpt`
4. Каждый резервный провайдер имеет собственный независимый автоматический выключатель

## Проверка работоспособности

Фоновая проверка работоспособности выполняется каждые ~30 секунд, отправляя лёгкие пробные запросы всем активным профилям. Статус работоспособности отображается в TUI-панели мониторинга с цветовой кодировкой:

- Зелёный: работает нормально
- Жёлтый: ухудшение (недавние сбои)
- Красный: автоматический выключатель открыт
